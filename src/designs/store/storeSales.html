<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Retail POS - Ventas de la Tienda</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Ionicons for icons -->
    <script
      type="module"
      src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule
      src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"
    ></script>
    <!-- Chart.js for graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      /* Custom scrollbar for a cleaner look */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #f1f5f9;
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <div class="flex h-screen">
      <!-- Sidebar de Navegación -->
      <aside class="w-64 bg-white flex flex-col shadow-lg">
        <!-- Perfil de Usuario -->
        <div class="p-6 border-b">
          <div class="flex items-center space-x-4">
            <img
              class="h-10 w-10 rounded-full object-cover"
              src="https://placehold.co/100x100/E2E8F0/4A5568?text=AV"
              alt="Avatar de Usuario"
            />
            <div>
              <p class="font-semibold text-gray-800">Ana García</p>
              <span
                class="text-xs text-green-500 font-medium bg-green-100 px-2 py-0.5 rounded-full"
                >Cajero</span
              >
            </div>
          </div>
        </div>

        <!-- Menú Principal -->
        <nav class="flex-1 px-4 py-6 space-y-4">
          <div>
            <p
              class="px-4 text-xs font-semibold text-gray-400 uppercase tracking-wider"
            >
              General
            </p>
            <div class="mt-2 space-y-1">
              <a
                href="#"
                class="flex items-center space-x-3 px-4 py-2.5 text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded-lg"
              >
                <ion-icon name="grid-outline" class="text-xl"></ion-icon>
                <span>Punto de Venta</span>
              </a>
              <a
                href="#"
                class="flex items-center space-x-3 px-4 py-2.5 bg-indigo-50 text-indigo-700 font-semibold rounded-lg"
              >
                <ion-icon name="receipt-outline" class="text-xl"></ion-icon>
                <span>Ventas</span>
              </a>
            </div>
          </div>
          <div>
            <p
              class="px-4 text-xs font-semibold text-gray-400 uppercase tracking-wider"
            >
              Gestión
            </p>
            <div class="mt-2 space-y-1">
              <a
                href="#"
                class="flex items-center space-x-3 px-4 py-2.5 text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded-lg"
              >
                <ion-icon name="people-outline" class="text-xl"></ion-icon>
                <span>Clientes</span>
              </a>
              <a
                href="#"
                class="flex items-center space-x-3 px-4 py-2.5 text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded-lg"
              >
                <ion-icon name="cube-outline" class="text-xl"></ion-icon>
                <span>Productos</span>
              </a>
            </div>
          </div>
        </nav>

        <!-- Menú de Salida -->
        <div class="px-4 py-6 border-t">
          <a
            href="#"
            class="flex items-center space-x-3 px-4 py-2.5 text-red-500 hover:bg-red-50 rounded-lg"
          >
            <ion-icon name="log-out-outline" class="text-xl"></ion-icon>
            <span>Cerrar Sesión</span>
          </a>
        </div>
      </aside>

      <!-- Contenido Principal -->
      <main class="flex-1 grid grid-cols-12 gap-6 p-6 overflow-y-auto">
        <!-- Columna Izquierda: Listado de Ventas -->
        <div class="col-span-12 lg:col-span-8 flex flex-col gap-6">
          <div class="bg-white p-6 rounded-xl shadow-lg">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-2xl font-bold text-gray-800">Ventas del Día</h2>
              <button
                id="open-stats-modal-btn"
                class="flex items-center space-x-2 bg-gray-100 text-gray-700 font-semibold px-4 py-2 rounded-lg hover:bg-gray-200 transition"
              >
                <ion-icon name="bar-chart-outline"></ion-icon>
                <span>Ver Detalles</span>
              </button>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full text-sm text-left text-gray-500">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                  <tr>
                    <th scope="col" class="px-6 py-3">ID Venta</th>
                    <th scope="col" class="px-6 py-3">Hora</th>
                    <th scope="col" class="px-6 py-3">Cajero</th>
                    <th scope="col" class="px-6 py-3">Total</th>
                    <th scope="col" class="px-6 py-3">Acción</th>
                  </tr>
                </thead>
                <tbody id="sales-table-body">
                  <!-- Fila de ejemplo 1 -->
                  <tr class="bg-white border-b hover:bg-gray-50">
                    <td class="px-6 py-4 font-mono text-gray-700">#8A34F-1</td>
                    <td class="px-6 py-4">01:15 PM</td>
                    <td class="px-6 py-4 font-medium text-gray-900">
                      Ana García
                    </td>
                    <td class="px-6 py-4 font-bold">$1,796.83</td>
                    <td class="px-6 py-4">
                      <button
                        data-ticket-id="#8A34F-1"
                        class="view-ticket-btn font-medium text-indigo-600 hover:underline"
                      >
                        Ver Ticket
                      </button>
                    </td>
                  </tr>
                  <!-- Fila de ejemplo 2 -->
                  <tr class="bg-white border-b hover:bg-gray-50">
                    <td class="px-6 py-4 font-mono text-gray-700">#8A34F-2</td>
                    <td class="px-6 py-4">12:55 PM</td>
                    <td class="px-6 py-4 font-medium text-gray-900">
                      Luis Torres
                    </td>
                    <td class="px-6 py-4 font-bold">$450.00</td>
                    <td class="px-6 py-4">
                      <button
                        data-ticket-id="#8A34F-2"
                        class="view-ticket-btn font-medium text-indigo-600 hover:underline"
                      >
                        Ver Ticket
                      </button>
                    </td>
                  </tr>
                  <!-- Fila de ejemplo 3 -->
                  <tr class="bg-white border-b hover:bg-gray-50">
                    <td class="px-6 py-4 font-mono text-gray-700">#8A34F-3</td>
                    <td class="px-6 py-4">12:30 PM</td>
                    <td class="px-6 py-4 font-medium text-gray-900">
                      Ana García
                    </td>
                    <td class="px-6 py-4 font-bold">$899.90</td>
                    <td class="px-6 py-4">
                      <button
                        data-ticket-id="#8A34F-3"
                        class="view-ticket-btn font-medium text-indigo-600 hover:underline"
                      >
                        Ver Ticket
                      </button>
                    </td>
                  </tr>
                  <!-- Auto-generated rows -->
                  <script>
                    const cashiers = [
                      "Ana García",
                      "Luis Torres",
                      "Sofía Ramírez",
                    ];
                    for (let i = 4; i <= 10; i++) {
                      const randomCashier =
                        cashiers[Math.floor(Math.random() * cashiers.length)];
                      const randomTotal = (Math.random() * 2000 + 100).toFixed(
                        2
                      );
                      document.write(`
                                            <tr class="bg-white border-b hover:bg-gray-50">
                                                <td class="px-6 py-4 font-mono text-gray-700">#8A34F-${i}</td>
                                                <td class="px-6 py-4">12:${
                                                  60 - i * 3
                                                } PM</td>
                                                <td class="px-6 py-4 font-medium text-gray-900">${randomCashier}</td>
                                                <td class="px-6 py-4 font-bold">$${randomTotal}</td>
                                                <td class="px-6 py-4"><button data-ticket-id="#8A34F-${i}" class="view-ticket-btn font-medium text-indigo-600 hover:underline">Ver Ticket</button></td>
                                            </tr>
                                        `);
                    }
                  </script>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Columna Derecha: Cierre y Estadísticas -->
        <div class="col-span-12 lg:col-span-4 flex flex-col gap-6">
          <!-- Cierre de Caja -->
          <div class="bg-white p-6 rounded-xl shadow-lg">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Cierre de Caja</h3>
            <div class="space-y-3">
              <button
                class="w-full open-cash-close-btn flex items-center justify-between p-4 bg-indigo-50 hover:bg-indigo-100 rounded-lg transition"
              >
                <span class="font-semibold text-indigo-800"
                  >Turno Matutino (12:00 PM)</span
                >
                <ion-icon
                  name="chevron-forward-outline"
                  class="text-indigo-600"
                ></ion-icon>
              </button>
              <button
                class="w-full open-cash-close-btn flex items-center justify-between p-4 bg-indigo-50 hover:bg-indigo-100 rounded-lg transition"
              >
                <span class="font-semibold text-indigo-800"
                  >Turno Vespertino (04:00 PM)</span
                >
                <ion-icon
                  name="chevron-forward-outline"
                  class="text-indigo-600"
                ></ion-icon>
              </button>
              <button
                class="w-full open-cash-close-btn flex items-center justify-between p-4 bg-indigo-50 hover:bg-indigo-100 rounded-lg transition"
              >
                <span class="font-semibold text-indigo-800"
                  >Cierre de Tienda (08:00 PM)</span
                >
                <ion-icon
                  name="chevron-forward-outline"
                  class="text-indigo-600"
                ></ion-icon>
              </button>
            </div>
          </div>

          <!-- Productos más vendidos -->
          <div class="bg-white p-6 rounded-xl shadow-lg">
            <h3 class="text-xl font-bold text-gray-800 mb-4">
              Productos Más Vendidos
            </h3>
            <ul class="space-y-3">
              <li class="flex items-center justify-between">
                <span class="text-gray-700">Pantalón de Mezclilla</span>
                <span class="font-bold bg-gray-100 px-2 py-0.5 rounded"
                  >12 vendidos</span
                >
              </li>
              <li class="flex items-center justify-between">
                <span class="text-gray-700">Camisa Casual</span>
                <span class="font-bold bg-gray-100 px-2 py-0.5 rounded"
                  >9 vendidos</span
                >
              </li>
              <li class="flex items-center justify-between">
                <span class="text-gray-700">Cinturón de Piel</span>
                <span class="font-bold bg-gray-100 px-2 py-0.5 rounded"
                  >7 vendidos</span
                >
              </li>
            </ul>
          </div>
          <!-- Ventas por Método de Pago -->
          <div class="bg-white p-6 rounded-xl shadow-lg">
            <h3 class="text-xl font-bold text-gray-800 mb-4">
              Ventas por Método de Pago
            </h3>
            <div class="space-y-3">
              <div>
                <div class="flex justify-between mb-1">
                  <span class="text-base font-medium text-gray-700"
                    >Efectivo</span
                  >
                  <span class="text-sm font-medium text-gray-700"
                    >$4,520.50</span
                  >
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                  <div
                    class="bg-green-500 h-2.5 rounded-full"
                    style="width: 45%"
                  ></div>
                </div>
              </div>
              <div>
                <div class="flex justify-between mb-1">
                  <span class="text-base font-medium text-gray-700"
                    >Tarjeta</span
                  >
                  <span class="text-sm font-medium text-gray-700"
                    >$3,890.00</span
                  >
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                  <div
                    class="bg-blue-500 h-2.5 rounded-full"
                    style="width: 38%"
                  ></div>
                </div>
              </div>
              <div>
                <div class="flex justify-between mb-1">
                  <span class="text-base font-medium text-gray-700"
                    >Transferencia</span
                  >
                  <span class="text-sm font-medium text-gray-700"
                    >$1,710.30</span
                  >
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                  <div
                    class="bg-purple-500 h-2.5 rounded-full"
                    style="width: 17%"
                  ></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Modals -->
    <!-- Modal de Cierre de Caja -->
    <div
      id="cash-close-modal"
      class="fixed inset-0 bg-gray-900 bg-opacity-60 flex items-center justify-center z-50 hidden transition-opacity duration-300"
    >
      <div
        class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-8 m-4 transform transition-all duration-300 scale-95 opacity-0"
        id="cash-close-content"
      >
        <div class="flex justify-between items-center border-b pb-4 mb-6">
          <h2 class="text-2xl font-bold text-gray-800">
            Cierre de Caja - Turno Matutino
          </h2>
          <button
            class="close-modal-btn text-gray-400 hover:text-gray-800 text-3xl"
            data-modal-id="cash-close-modal"
          >
            &times;
          </button>
        </div>
        <!-- Contenido del Modal de Cierre -->
        <div>
          <div class="grid grid-cols-2 gap-6 mb-6">
            <div class="bg-gray-50 p-4 rounded-lg">
              <h4 class="font-bold text-gray-700 mb-3">Totales del Sistema</h4>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-600">Ventas Efectivo:</span
                  ><span class="font-semibold text-gray-800">$2,150.50</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Ventas Tarjeta:</span
                  ><span class="font-semibold text-gray-800">$1,840.00</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Ventas Transferencia:</span
                  ><span class="font-semibold text-gray-800">$950.00</span>
                </div>
                <div
                  class="flex justify-between pt-2 border-t mt-2 font-bold text-base"
                >
                  <span class="text-indigo-800">Total Esperado en Caja:</span
                  ><span class="text-indigo-800">$2,150.50</span>
                </div>
              </div>
            </div>
            <div class="bg-blue-50 p-4 rounded-lg">
              <h4 class="font-bold text-gray-700 mb-3">Arqueo Manual</h4>
              <label
                for="counted-amount"
                class="block text-sm font-medium text-gray-700"
                >Monto Contado en Caja</label
              >
              <input
                type="number"
                id="counted-amount"
                value="2150.50"
                class="w-full mt-1 border border-gray-300 rounded-lg py-2 px-3 text-lg font-bold text-right focus:ring-2 focus:ring-indigo-500"
              />
              <div class="mt-3 flex justify-between font-bold text-base">
                <span class="text-red-800">Diferencia:</span>
                <span id="difference-amount" class="text-red-800">$0.00</span>
              </div>
            </div>
          </div>
          <div>
            <label
              for="notes"
              class="block text-sm font-medium text-gray-700 mb-2"
              >Notas Adicionales</label
            >
            <textarea
              id="notes"
              rows="3"
              class="w-full border border-gray-300 rounded-lg py-2 px-3 focus:ring-2 focus:ring-indigo-500"
              placeholder="Ej: Faltante por error de cambio..."
            ></textarea>
          </div>
          <div class="mt-8 flex justify-end">
            <button
              class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 transition"
            >
              Confirmar Cierre de Caja
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de Estadísticas Detalladas -->
    <div
      id="stats-modal"
      class="fixed inset-0 bg-gray-900 bg-opacity-60 flex items-center justify-center z-50 hidden transition-opacity duration-300"
    >
      <div
        class="bg-white rounded-xl shadow-2xl w-full max-w-4xl p-8 m-4 transform transition-all duration-300 scale-95 opacity-0"
      >
        <div class="flex justify-between items-center border-b pb-4 mb-6">
          <h2 class="text-2xl font-bold text-gray-800">
            Estadísticas Detalladas del Día
          </h2>
          <button
            class="close-modal-btn text-gray-400 hover:text-gray-800 text-3xl"
            data-modal-id="stats-modal"
          >
            &times;
          </button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="md:col-span-2">
            <h3 class="font-bold text-lg mb-2">Ventas por Hora</h3>
            <canvas id="salesByHourChart"></canvas>
          </div>
          <div class="md:col-span-1">
            <h3 class="font-bold text-lg mb-2">Ventas por Cajero</h3>
            <canvas id="salesByCashierChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de Ver Ticket -->
    <div
      id="ticket-modal"
      class="fixed inset-0 bg-gray-900 bg-opacity-60 flex items-center justify-center z-50 hidden transition-opacity duration-300"
    >
      <div
        class="bg-white rounded-xl shadow-2xl w-full max-w-md p-8 m-4 transform transition-all duration-300 scale-95 opacity-0"
      >
        <div class="flex justify-between items-center border-b pb-4 mb-6">
          <h2 id="ticket-modal-title" class="text-2xl font-bold text-gray-800">
            Detalle de Venta
          </h2>
          <button
            class="close-modal-btn text-gray-400 hover:text-gray-800 text-3xl"
            data-modal-id="ticket-modal"
          >
            &times;
          </button>
        </div>
        <!-- Ticket Content -->
        <div class="space-y-4">
          <p><span class="font-semibold">Cajero:</span> Ana García</p>
          <div class="border-t border-b py-2 space-y-2">
            <div class="flex justify-between">
              <p>Pantalón de Mezclilla (x1)</p>
              <p>$899.90</p>
            </div>
            <div class="flex justify-between">
              <p>Camisa Casual (x2)</p>
              <p>$896.93</p>
            </div>
          </div>
          <div class="space-y-1 font-semibold">
            <div class="flex justify-between">
              <span>Subtotal:</span><span>$1,796.83</span>
            </div>
            <div class="flex justify-between text-red-600">
              <span>Descuento:</span><span>$0.00</span>
            </div>
            <div class="flex justify-between text-xl border-t pt-2 mt-1">
              <span>TOTAL:</span><span>$1,796.83</span>
            </div>
          </div>
        </div>
        <div class="mt-8 grid grid-cols-2 gap-4">
          <button
            class="w-full flex items-center justify-center space-x-2 bg-gray-100 text-gray-800 font-semibold py-3 rounded-lg hover:bg-gray-200 transition"
          >
            <ion-icon name="print-outline" class="text-xl"></ion-icon
            ><span>Reimprimir</span>
          </button>
          <button
            id="open-pin-modal-btn"
            class="w-full bg-red-100 text-red-800 font-semibold py-3 rounded-lg hover:bg-red-200 transition"
          >
            Realizar Devolución
          </button>
        </div>
      </div>
    </div>

    <!-- Modal de PIN para Devolución -->
    <div
      id="pin-modal"
      class="fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center z-50 hidden transition-opacity duration-300"
    >
      <div
        class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-8 m-4 transform transition-all duration-300 scale-95 opacity-0"
      >
        <div class="text-center">
          <ion-icon
            name="shield-checkmark-outline"
            class="text-5xl text-indigo-500 mx-auto"
          ></ion-icon>
          <h2 class="text-2xl font-bold text-gray-800 mt-4">
            Autorización Requerida
          </h2>
          <p class="text-gray-600 mb-6">
            Ingresa el PIN de administrador para continuar.
          </p>
          <div id="pin-display" class="flex justify-center space-x-3 mb-6">
            <div class="w-4 h-4 bg-gray-200 rounded-full"></div>
            <div class="w-4 h-4 bg-gray-200 rounded-full"></div>
            <div class="w-4 h-4 bg-gray-200 rounded-full"></div>
            <div class="w-4 h-4 bg-gray-200 rounded-full"></div>
          </div>
          <div
            id="pin-keypad"
            class="grid grid-cols-3 gap-4 text-2xl font-bold"
          >
            <!-- Keypad will be generated by JS -->
          </div>
          <div class="mt-6 flex gap-4">
            <button
              id="close-pin-modal-btn"
              class="w-full bg-gray-100 text-gray-800 font-semibold py-3 rounded-lg hover:bg-gray-200 transition"
            >
              Cancelar
            </button>
            <button
              id="confirm-return-btn"
              class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 transition opacity-50"
              disabled
            >
              Confirmar
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- Generic Modal Logic ---
        const modals = {};
        const setupModal = (modalId) => {
          const modal = document.getElementById(modalId);
          const modalContent = modal.querySelector('div[class*="transform"]');
          modals[modalId] = { modal, modalContent };

          modal.addEventListener("click", (e) => {
            if (e.target === modal) closeModal(modalId);
          });
        };

        [
          "cash-close-modal",
          "stats-modal",
          "ticket-modal",
          "pin-modal",
        ].forEach(setupModal);

        const openModal = (modalId) => {
          const { modal, modalContent } = modals[modalId];
          modal.classList.remove("hidden");
          setTimeout(() => {
            modal.classList.remove("opacity-0");
            modalContent.classList.remove("scale-95", "opacity-0");
          }, 10);
        };

        const closeModal = (modalId) => {
          const { modal, modalContent } = modals[modalId];
          modalContent.classList.add("scale-95", "opacity-0");
          modal.classList.add("opacity-0");
          setTimeout(() => modal.classList.add("hidden"), 300);
        };

        document.querySelectorAll(".close-modal-btn").forEach((btn) => {
          btn.addEventListener("click", () => closeModal(btn.dataset.modalId));
        });

        // --- Cash Close Modal ---
        document.querySelectorAll(".open-cash-close-btn").forEach((btn) => {
          btn.addEventListener("click", () => openModal("cash-close-modal"));
        });

        // --- Stats Modal & Charts ---
        let salesByHourChart, salesByCashierChart;
        document
          .getElementById("open-stats-modal-btn")
          .addEventListener("click", () => {
            openModal("stats-modal");
            // Initialize charts only if they don't exist
            if (!salesByHourChart) {
              const ctxHour = document
                .getElementById("salesByHourChart")
                .getContext("2d");
              salesByHourChart = new Chart(ctxHour, {
                type: "bar",
                data: {
                  labels: ["9am", "10am", "11am", "12pm", "1pm", "2pm", "3pm"],
                  datasets: [
                    {
                      label: "Ventas ($)",
                      data: [120, 190, 300, 500, 200, 350, 450],
                      backgroundColor: "rgba(79, 70, 229, 0.8)",
                      borderColor: "rgba(79, 70, 229, 1)",
                      borderWidth: 1,
                    },
                  ],
                },
                options: { scales: { y: { beginAtZero: true } } },
              });
            }
            if (!salesByCashierChart) {
              const ctxCashier = document
                .getElementById("salesByCashierChart")
                .getContext("2d");
              salesByCashierChart = new Chart(ctxCashier, {
                type: "doughnut",
                data: {
                  labels: ["Ana García", "Luis Torres", "Sofía Ramírez"],
                  datasets: [
                    {
                      data: [45, 30, 25],
                      backgroundColor: ["#4f46e5", "#6366f1", "#a5b4fc"],
                      hoverOffset: 4,
                    },
                  ],
                },
              });
            }
          });

        // --- Ticket & PIN Modals ---
        document
          .getElementById("sales-table-body")
          .addEventListener("click", (e) => {
            if (e.target.classList.contains("view-ticket-btn")) {
              const ticketId = e.target.dataset.ticketId;
              document.getElementById(
                "ticket-modal-title"
              ).textContent = `Detalle de Venta ${ticketId}`;
              openModal("ticket-modal");
            }
          });

        document
          .getElementById("open-pin-modal-btn")
          .addEventListener("click", () => {
            closeModal("ticket-modal");
            openModal("pin-modal");
          });

        document
          .getElementById("close-pin-modal-btn")
          .addEventListener("click", () => closeModal("pin-modal"));

        // --- PIN Pad Logic ---
        const pinDisplay = document.getElementById("pin-display");
        const keypad = document.getElementById("pin-keypad");
        const confirmBtn = document.getElementById("confirm-return-btn");
        let pin = "";

        const updatePinDisplay = () => {
          for (let i = 0; i < 4; i++) {
            pinDisplay.children[i].classList.toggle(
              "bg-indigo-500",
              i < pin.length
            );
            pinDisplay.children[i].classList.toggle(
              "bg-gray-200",
              i >= pin.length
            );
          }
          if (pin.length === 4) {
            confirmBtn.disabled = false;
            confirmBtn.classList.remove("opacity-50");
          } else {
            confirmBtn.disabled = true;
            confirmBtn.classList.add("opacity-50");
          }
        };

        const handleKeyPress = (key) => {
          if (key === "del") {
            pin = pin.slice(0, -1);
          } else if (pin.length < 4) {
            pin += key;
          }
          updatePinDisplay();
        };

        ["1", "2", "3", "4", "5", "6", "7", "8", "9", "C", "0", "del"].forEach(
          (key) => {
            const btn = document.createElement("button");
            btn.className =
              "py-4 bg-gray-100 rounded-lg hover:bg-gray-200 transition";
            btn.textContent = key === "del" ? "⌫" : key;
            btn.onclick = () =>
              handleKeyPress(key === "C" ? ((pin = ""), "C") : key);
            keypad.appendChild(btn);
          }
        );
      });
    </script>
  </body>
</html>
